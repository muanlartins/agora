@import 'variables';

// =============================================================================
// CREATE DEBATE FORM - Redesigned for Dark Theme Elegance
// =============================================================================

:host {
  display: block;
  width: 100%;
}

// -----------------------------------------------------------------------------
// Cancel Button (Modal Mode Only)
// -----------------------------------------------------------------------------
.cancel {
  display: none; // Hidden - modal has its own close
}

// -----------------------------------------------------------------------------
// Form Container
// -----------------------------------------------------------------------------
.form {
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: 0;

  &--standalone {
    background: transparent;
  }
}

// -----------------------------------------------------------------------------
// Stepper Customization
// -----------------------------------------------------------------------------
.form__stepper {
  background: transparent;

  // Step header styling
  ::ng-deep {
    .mat-step-header {
      padding: $space-4 $space-2;

      .mat-step-icon {
        background: $surface-elevated-dark;
        color: $text-muted-dark;
        border: 1px solid $border-dark;

        &.mat-step-icon-selected,
        &.mat-step-icon-state-edit {
          background: $primary;
          color: $background-dark;
          border-color: $primary;
        }
      }

      .mat-step-label {
        font-family: $font-body;
        font-size: $font-size-sm;
        color: $text-muted-dark;

        &.mat-step-label-active {
          color: $text-primary-dark;
        }

        &.mat-step-label-selected {
          color: $primary;
          font-weight: $font-weight-medium;
        }
      }

      &:hover:not([aria-disabled="true"]) {
        background: $surface-elevated-dark;
      }
    }

    .mat-stepper-vertical-line::before {
      border-left-color: $border-dark;
    }

    .mat-vertical-content-container {
      margin-left: 36px;
      border-left: 1px solid $border-dark;
    }

    .mat-vertical-content {
      padding: $space-4 $space-6 $space-6 $space-6;
    }
  }
}

// -----------------------------------------------------------------------------
// Step Content Areas
// -----------------------------------------------------------------------------
.form__stepper__step {

  // -------------------------------------------------------------------------
  // STEP 1: Debate Details
  // -------------------------------------------------------------------------
  &__debate {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: $space-4;
    padding-top: $space-4;

    @media (max-width: $breakpoint-md) {
      grid-template-columns: 1fr;
    }

    &__input {
      position: relative;

      &--motion {
        grid-column: 1 / -1;
      }

      img {
        position: absolute;
        right: $space-4;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        cursor: pointer;
        filter: $filter;
        opacity: 0.5;
        transition: opacity $transition-fast;

        &:hover {
          opacity: 1;
        }
      }
    }

    button {
      height: 48px;
      font-family: $font-body;
      font-weight: $font-weight-medium;

      &[mat-stroked-button] {
        border-color: $border-dark;
        color: $text-secondary-dark;

        &:hover {
          background: $surface-elevated-dark;
          border-color: $primary-muted;
        }
      }
    }
  }

  // -------------------------------------------------------------------------
  // STEP 2: Debaters
  // -------------------------------------------------------------------------
  &__debaters {
    display: flex;
    flex-direction: column;
    gap: $space-6;
    padding-top: $space-4;
    user-select: none;

    // Filters Section
    &__filters {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: $space-4;
      align-items: center;
      padding: $space-4;
      background: $surface-dark;
      border: 1px solid $border-dark;
      border-radius: $radius-md;

      @media (max-width: $breakpoint-md) {
        grid-template-columns: 1fr;
      }

      &__field {
        &--society img {
          right: 2.5rem;
        }
      }

      // Checkbox styling
      ::ng-deep .mat-mdc-checkbox {
        .mdc-checkbox {
          --mdc-checkbox-selected-checkmark-color: #{$background-dark};
          --mdc-checkbox-selected-focus-icon-color: #{$primary};
          --mdc-checkbox-selected-hover-icon-color: #{$primary-light};
          --mdc-checkbox-selected-icon-color: #{$primary};
          --mdc-checkbox-selected-pressed-icon-color: #{$primary};
        }
        .mdc-label {
          color: $text-secondary-dark;
          font-family: $font-body;
          font-size: $font-size-sm;
        }
      }
    }

    // Debater Selection Grid
    &__all {
      display: flex;
      flex-direction: column;
      gap: $space-3;

      &__label {
        font-family: $font-body;
        font-size: $font-size-sm;
        font-weight: $font-weight-medium;
        color: $text-secondary-dark;
        margin-bottom: $space-2;
      }

      &__checkbox {
        display: flex;
        align-items: center;
        padding: $space-2 $space-3;
        background: $surface-dark;
        border: 1px solid $border-dark;
        border-radius: $radius-sm;
        transition: all $transition-fast;

        &:hover {
          background: $surface-elevated-dark;
          border-color: $primary-muted;
        }

        ::ng-deep .mdc-form-field {
          width: 100%;
        }

        ::ng-deep .mdc-label {
          display: flex;
          align-items: center;
          gap: $space-2;
          font-family: $font-body;
          font-size: $font-size-sm;
          color: $text-primary-dark;
        }

        &__pfp {
          margin-right: $space-2;
        }
      }
    }

    // Iron Selection
    &__iron {
      display: flex;
      flex-direction: column;
      gap: $space-3;
      padding: $space-4;
      background: rgba($warning, 0.1);
      border: 1px solid rgba($warning, 0.3);
      border-radius: $radius-md;

      &__label {
        font-family: $font-body;
        font-size: $font-size-sm;
        font-weight: $font-weight-medium;
        color: $warning;
      }

      ::ng-deep .mat-mdc-checkbox {
        .mdc-label {
          color: $text-primary-dark;
          font-family: $font-body;
          font-size: $font-size-sm;
        }
      }
    }

    // House Legend
    &__houses {
      display: flex;
      flex-wrap: wrap;
      gap: $space-2;
      margin-top: $space-2;

      &__legend {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: $space-2 $space-3;
        font-family: $font-body;
        font-size: $font-size-xs;
        font-weight: $font-weight-semibold;
        text-transform: uppercase;
        letter-spacing: $letter-spacing-wide;
        border-radius: $radius-sm;
        cursor: pointer;
        transition: all $transition-fast;

        &--focus {
          transform: scale(1.05);
          box-shadow: $shadow-md;
        }

        &--blur {
          opacity: 0.3;
        }

        &--og {
          background: $og;
          border: 1px solid $og-border;
          color: $og-text;
        }

        &--oo {
          background: $oo;
          border: 1px solid $oo-border;
          color: $oo-text;
        }

        &--cg {
          background: $cg;
          border: 1px solid $cg-border;
          color: $cg-text;
        }

        &--co {
          background: $co;
          border: 1px solid $co-border;
          color: $co-text;
        }
      }
    }

    // Debater Positions (Drag & Drop)
    &__positions {
      display: flex;
      flex-direction: column;
      gap: $space-2;
      padding: $space-3;
      background: $surface-dark;
      border: 1px solid $border-dark;
      border-radius: $radius-md;

      &.cdk-drop-list-dragging &__debater:not(.cdk-drag-placeholder) {
        transition: transform $transition-fast;
      }

      &__debater {
        display: flex;
        align-items: center;
        gap: $space-3;
        padding: $space-3 $space-4;
        background: $surface-elevated-dark;
        border-radius: $radius-sm;
        border-left: 3px solid transparent;
        cursor: grab;
        transition: all $transition-fast;

        &:hover {
          background: lighten($surface-elevated-dark, 3%);
        }

        &:active {
          cursor: grabbing;
        }

        &--blur {
          opacity: 0.3;
        }

        &--og {
          background: $og;
          border-left-color: $og-border;
        }

        &--oo {
          background: $oo;
          border-left-color: $oo-border;
        }

        &--cg {
          background: $cg;
          border-left-color: $cg-border;
        }

        &--co {
          background: $co;
          border-left-color: $co-border;
        }

        &__placeholder {
          background: $surface-elevated-dark;
          border: 2px dashed $border-dark;
          border-radius: $radius-sm;
          height: 52px;
        }

        &__content {
          display: flex;
          flex-direction: column;
          gap: $space-1;
          flex: 1;

          &__name {
            font-family: $font-body;
            font-size: $font-size-sm;
            font-weight: $font-weight-medium;
            color: $text-primary-dark;
          }

          &__position {
            font-family: $font-body;
            font-size: $font-size-xs;
            font-weight: $font-weight-semibold;
            text-transform: uppercase;
            letter-spacing: $letter-spacing-wide;
            color: $text-muted-dark;
          }
        }

        // Drag handle indicator
        &::before {
          content: '⋮⋮';
          font-size: $font-size-sm;
          color: $text-muted-dark;
          letter-spacing: -2px;
        }

        &__remove {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 24px;
          height: 24px;
          padding: 0;
          border: none;
          border-radius: $radius-full;
          background: transparent;
          color: $text-muted-dark;
          font-size: $font-size-lg;
          cursor: pointer;
          transition: all $transition-fast;
          opacity: 0;

          &:hover {
            background: rgba($danger, 0.2);
            color: $danger;
          }
        }

        &:hover &__remove {
          opacity: 1;
        }
      }
    }

    // Speaker Points
    &__sps {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: $space-4;

      @media (max-width: $breakpoint-md) {
        grid-template-columns: 1fr;
      }

      mat-form-field {
        width: 100% !important;
      }
    }

    // Call Results (Drag & Drop)
    &__call {
      display: flex;
      flex-direction: column;
      gap: $space-2;
      padding: $space-3;
      background: $surface-dark;
      border: 1px solid $border-dark;
      border-radius: $radius-md;

      &.cdk-drop-list-dragging &__house:not(.cdk-drag-placeholder) {
        transition: transform $transition-fast;
      }

      &__house {
        display: flex;
        align-items: center;
        gap: $space-3;
        padding: $space-4;
        background: $surface-elevated-dark;
        border-radius: $radius-sm;
        border-left: 3px solid transparent;
        cursor: grab;
        transition: all $transition-fast;

        &:hover {
          background: lighten($surface-elevated-dark, 3%);
        }

        &:active {
          cursor: grabbing;
        }

        &--blur {
          opacity: 0.3;
        }

        &--og {
          background: $og;
          border-left-color: $og-border;
        }

        &--oo {
          background: $oo;
          border-left-color: $oo-border;
        }

        &--cg {
          background: $cg;
          border-left-color: $cg-border;
        }

        &--co {
          background: $co;
          border-left-color: $co-border;
        }

        &__placeholder {
          background: $surface-elevated-dark;
          border: 2px dashed $border-dark;
          border-radius: $radius-sm;
          height: 56px;
        }

        &__content {
          flex: 1;

          &__name {
            font-family: $font-body;
            font-size: $font-size-base;
            font-weight: $font-weight-medium;
            color: $text-primary-dark;
          }
        }

        // Drag handle indicator
        &::before {
          content: '⋮⋮';
          font-size: $font-size-sm;
          color: $text-muted-dark;
          letter-spacing: -2px;
        }
      }
    }
  }

  // -------------------------------------------------------------------------
  // STEP 3: Judges
  // -------------------------------------------------------------------------
  &__judges {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: $space-4;
    padding-top: $space-4;

    @media (max-width: $breakpoint-md) {
      grid-template-columns: 1fr;
    }

    mat-form-field {
      position: relative;

      img {
        position: absolute;
        right: 2.5rem;
        top: 50%;
        transform: translateY(-50%);
        width: 18px;
        height: 18px;
        cursor: pointer;
        filter: $filter;
        opacity: 0.5;
        transition: opacity $transition-fast;

        &:hover {
          opacity: 1;
        }
      }
    }

    button {
      height: 48px;
      font-family: $font-body;
      font-weight: $font-weight-medium;

      &[mat-stroked-button] {
        border-color: $border-dark;
        color: $text-secondary-dark;

        &:hover {
          background: $surface-elevated-dark;
          border-color: $primary-muted;
        }
      }
    }
  }
}

// -----------------------------------------------------------------------------
// Section Labels
// -----------------------------------------------------------------------------
.section-label {
  font-family: $font-body;
  font-size: $font-size-xs;
  font-weight: $font-weight-semibold;
  text-transform: uppercase;
  letter-spacing: $letter-spacing-wider;
  color: $text-muted-dark;
  margin-bottom: $space-3;
}

// Inline section labels used in template
div[style*="font-weight: 500"] {
  font-family: $font-body !important;
  font-size: $font-size-xs !important;
  font-weight: $font-weight-semibold !important;
  text-transform: uppercase;
  letter-spacing: $letter-spacing-wider;
  color: $text-muted-dark !important;
  margin-bottom: $space-3;
}

// -----------------------------------------------------------------------------
// Material Form Field Overrides
// -----------------------------------------------------------------------------
::ng-deep {
  .mat-mdc-form-field {
    width: 100%;

    .mdc-text-field--outlined {
      --mdc-outlined-text-field-container-shape: #{$radius-md};
    }

    .mat-mdc-form-field-subscript-wrapper {
      height: auto;
    }
  }

  // Select dropdown styling
  .mat-mdc-select-panel {
    background: $surface-elevated-dark;
    border: 1px solid $border-dark;

    .mat-mdc-option {
      font-family: $font-body;
      font-size: $font-size-sm;

      &:hover:not(.mat-mdc-option-disabled) {
        background: rgba($primary, 0.1);
      }

      &.mat-mdc-option-active {
        background: rgba($primary, 0.15);
      }
    }
  }

  // Datepicker styling
  .mat-datepicker-content {
    background: $surface-elevated-dark;
    border: 1px solid $border-dark;

    .mat-calendar {
      font-family: $font-body;
    }
  }
}

// -----------------------------------------------------------------------------
// Form Field Input Padding (for delete icons)
// -----------------------------------------------------------------------------
input, textarea {
  padding-right: 3rem;
}

// -----------------------------------------------------------------------------
// CDK Drag Preview
// -----------------------------------------------------------------------------
.cdk-drag-preview {
  box-shadow: $shadow-xl;
  border-radius: $radius-sm;
  opacity: 0.9;
}

.cdk-drag-animating {
  transition: transform $transition-base;
}
